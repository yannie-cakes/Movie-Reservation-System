<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="trans_styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Varela+Round&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="nav-bar">
        <div class="profile">
            <div class="avatar"></div>
            <div class="info">
                <h3 class="emp-name">Employee Name</h3>
                <h4 class="emp-id">31735127</h4>
            </div>
        </div>
        <h4 class="label">Databases</h4>
        <a href="">
            <div class="tab">
                <i class="bi bi-people-fill"></i>
                <h3 class="tab-label">Employees</h3>
            </div>
        </a>
        <a href="">
            <div class="tab">
                <i class="bi bi-bank2"></i>
                <h3 class="tab-label">Transactions</h3>
            </div>
        </a>
        <a href="">
            <div class="tab">
                <i class="bi bi-ticket-perforated-fill"></i>
                <h3 class="tab-label">Tickets</h3>
            </div>
        </a>

        <h4 class="label">Account Options</h4>
        <a href="">
            <div class="tab">
                <i class="bi bi-box-arrow-left"></i>
                <h3 class="tab-label">Log Out</h3>
            </div>
        </a>
    </nav>
    
    <div class="transaction-box">
        <h1 class="title">TRANSACTIONS</h1>
        <form action="" class="trans-form">
            <div class="container">
                <div class="customer">
                    <label for="fname">Customer First Name</label>
                    <input type="text" name="fname" placeholder=" Enter first name..." required>

                    <label for="mname">Customer Middle Name</label>
                    <input type="text" name="mname" placeholder=" Enter middle name..." required>

                    <label for="lname">Customer Last Name</label>
                    <input type="text" name="lname" placeholder=" Enter last name..." required>
                </div>

                <div class="payment-details">
                    <label for="seats">Seats</label>
                    <table name="seats">
                        <?php
                            if (isset($_GET['trans_number'])) {
                                $transNumber = $_GET['trans_number'];

                                // Fetch transaction details from the database based on transaction number
                                $query = "SELECT TICKET.SEAT_ID, TRANSACTIONS.TRANS_PAYMENT, TRANSACTIONS.TRANS_CHANGE
                                          FROM TICKET
                                          INNER JOIN TRANSACTIONS ON TICKET.TRANS_NUMBER = TRANSACTIONS.TRANS_NUMBER
                                          WHERE TRANSACTIONS.TRANS_NUMBER = ?";
                                $stmt = $mysqli->prepare($query);
                                $stmt->bind_param("i", $transNumber);
                                $stmt->execute();
                                $result = $stmt->get_result();

                                if ($result->num_rows > 0) {
                                    while ($row = $result->fetch_assoc()) {
                                        echo "<tr><td>" . $row['SEAT_ID'] . "</td></tr>";
                                    }

                                    // Get the total payment and change for display
                                    $row = $result->fetch_assoc();
                                    $totalPrice = $row['TRANS_PAYMENT'];
                                    $change = $row['TRANS_CHANGE'];
                                } else {
                                    echo "<tr><td>No seats reserved for this transaction.</td></tr>";
                                }
                            }
                        ?>
                    </table>

                    <label for="price">Total Price</label>
                    <p name="price">
                        <?php
                            if (isset($totalPrice)) {
                                echo "₱" . $totalPrice; // Display the total price
                            }
                        ?>
                    </p>

                    <label for="payment">Total Payment</label>
                    <input type="number" name="payment" placeholder=" Enter payment..." required>

                    <label for="change">Total Change</label>
                    <p name="change">
                        <?php
                            if (isset($change)) {
                                echo "₱" . $change; // Display the change
                            }
                        ?>
                    </p>
                </div>  
            </div>
            <input type="submit" formaction="" value="Confirm">
        </form>
    </div>
</body>
</html>
